<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if page.title %}{{ page.title }} · {% endif %}{{ site.title }}</title>
    <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | strip_newlines | truncate: 160 }}">
    <meta name="theme-color" content="#019733">
    <meta property="og:title" content="{% if page.title %}{{ page.title }} · {% endif %}{{ site.title }}">
    <meta property="og:description" content="{{ page.excerpt | default: site.description | strip_html | strip_newlines | truncate: 160 }}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ page.url | absolute_url }}">
    <meta property="og:site_name" content="{{ site.title }}">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="{% if page.title %}{{ page.title }} · {% endif %}{{ site.title }}">
    <meta name="twitter:description" content="{{ page.excerpt | default: site.description | strip_html | strip_newlines | truncate: 160 }}">
    <link rel="canonical" href="{{ page.url | absolute_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
</head>
<body>
    <button class="hamburger" id="hamburger" aria-label="Toggle navigation">
        <span></span><span></span><span></span>
    </button>
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <div class="{% if page.layout == 'post' %}post-layout{% else %}site-wrapper{% endif %}">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">vimOS</div>
                <p class="sidebar-tagline">A modal-native operating system experiment.</p>
            </div>

            <nav class="sidebar-nav" aria-label="Primary">
                <ul>
                    <li><a href="{{ '/' | relative_url }}" {% if page.url == '/' %}class="active"{% endif %}>~/home</a></li>
                    <li><a href="{{ '/posts' | relative_url }}" {% if page.url == '/posts/' or page.layout == 'post' %}class="active"{% endif %}>~/post</a></li>
                </ul>
            </nav>

            <div class="external-links">
                <a href="https://github.com/saeeedhany/vimOS" target="_blank" rel="noopener">GitHub</a>
                <a href="https://vimos.org" target="_blank" rel="noopener">vimos.org</a>
            </div>

            {% if page.layout == 'post' %}
            <div class="toc" id="toc">
                <h3>On This Page</h3>
                <ul id="toc-list"></ul>
            </div>
            {% endif %}

            <button id="theme-toggle" class="theme-toggle">[light]</button>
        </aside>

        <div class="main-content">
            <main>{{ content }}</main>
            <footer>
                <p>© 2026 vimOS.</p>
                <p>Modal interaction research on RISC-V.</p>
            </footer>
        </div>

        {% if page.layout == 'post' %}
        <aside class="right-toc" id="right-toc">
            <h3>On This Page</h3>
            <ul id="right-toc-list"></ul>
        </aside>

        <script>
        function generateTOC() {
            const content = document.getElementById('post-content');
            const rightTocList = document.getElementById('right-toc-list');
            const sidebarTocList = document.getElementById('toc-list');
            if (!content) return;

            const headings = content.querySelectorAll('h2, h3');
            if (headings.length === 0) return;

            let tocHTML = '';
            let currentH2 = null;

            headings.forEach((heading, index) => {
                const id = heading.id || `heading-${index}`;
                heading.id = id;
                const level = heading.tagName.toLowerCase();

                if (level === 'h2') {
                    if (currentH2 !== null) tocHTML += '</ul></li>';
                    tocHTML += `<li><a href="#${id}" class="toc-link">${heading.textContent}</a><ul>`;
                    currentH2 = index;
                } else {
                    tocHTML += `<li><a href="#${id}" class="toc-link">${heading.textContent}</a></li>`;
                }
            });

            if (currentH2 !== null) tocHTML += '</ul></li>';
            if (rightTocList) rightTocList.innerHTML = tocHTML;
            if (sidebarTocList) sidebarTocList.innerHTML = tocHTML;
        }

        document.addEventListener('DOMContentLoaded', generateTOC);
        </script>
        {% endif %}
    </div>

    <script src="{{ '/assets/js/theme.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/mobile-menu.js' | relative_url }}"></script>
</body>
</html>
